---
title: "Map of COVID Death Cases"
description: |
  This post will be showing how I created a choropleth map that shows which states had more deaths due to COVID as of Feb. 22 compared with others.
author:
  - name: Nicole Miller
    url: https://www.google.com
date: 04-18-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

The first thing I did was download the necessary packages and then import the New York Time's COVID case data for US states. I also downloaded the polygon boundaries for states at the lowest resolution using the tigris package.

I then filtered the covidcases data to only show the number of deaths on 2021-02-22. I selected the date, state, and deaths columns to be the only information shown. I renamed this data 'filtered_states'. I then utilized the geo-join function in order to merge the 'states' and 'filtered_states' data sets together. After that, I ran the mypalette function and selected my map color scheme to be yellow and green. I then started adding in all of my data into the Leaflet function. I selected the appropriate coordinates and zoom level in setView and added the appropriate data in the addPolygons function. I selected the fill color, fill opacity, weight, smoothfactor, and label options. The addLegend function allowed me to add in a small box on the bottom right corner called "Total death". I set the number of bins to 4 so that only four values were displayed. After that I ran the function and got my choropleth map.

```{r}
library(tidyverse)
library(lubridate)
library(readxl)
library(janitor)
library(glue)
library(leaflet)
library(RColorBrewer)
library(htmlwidgets)
library(htmltools)
library(tigris)
library(tmap)
library(tmaptools)
library(dplyr)
options(tigris_class = "sf")

covidcases <- read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv")

states <- tigris::states(cb=T)

filtered_states <- covidcases %>%
  filter(date== "2021-02-22") %>%
  select(date, state, deaths)

states_merged_sb <- geo_join(states, filtered_states, "NAME", "state")

states_merged_sb <- subset(states_merged_sb, !is.na(deaths))
states_merged_sb$deaths <- as.integer(states_merged_sb$deaths)

mypalette <- colorNumeric("YlGn", domain = states_merged_sb$deaths)

popup_sb <- paste0("Total deaths: ", as.character(states_merged_sb$deaths))

leaflet() %>%
  addTiles() %>%
  setView(-98.48330, 38.712046, zoom = 4) %>%
  addPolygons(data = states_merged_sb,
              fillColor = ~mypalette(states_merged_sb$deaths),
              fillOpacity = 0.9,
              weight = 0.2,
              smoothFactor = 0.2,
              label = popup_sb,
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "15px",
                direction = "auto")) %>%
  addLegend(pal = mypalette,
            values = states_merged_sb$deaths,
            bins = 4,
            position = "bottomright",
            title = "Total deaths",
            labFormat = labelFormat(digits = 0))
          
```

```


